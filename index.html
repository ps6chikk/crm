<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Vinted CRM</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@300;400;500;600;700;800&family=Instrument+Serif:ital@0;1&display=swap');

:root {
  --bg: #0A0A0B;
  --s1: #111113;
  --s2: #18181B;
  --s3: #222226;
  --border: #2A2A30;
  --border2: #333340;
  --green: #00E5A0;
  --green-d: #003D2B;
  --green-m: #00C484;
  --red: #FF5C5C;
  --red-d: #2D0F0F;
  --yellow: #FFD166;
  --yellow-d: #2D2100;
  --blue: #60A5FA;
  --blue-d: #0D1F3C;
  --purple: #A78BFA;
  --text: #E8E8F0;
  --muted: #5A5A70;
  --muted2: #8080A0;
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}

body{
  font-family:'Bricolage Grotesque',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  padding-bottom:5rem;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header{
  background:var(--s1);
  border-bottom:1px solid var(--border);
  padding:1rem 1.2rem;
  display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;z-index:200;
  backdrop-filter:blur(20px);
}
.logo{font-family:'Instrument Serif',serif;font-size:1.5rem;color:var(--green);}
.logo span{color:var(--text);}
.header-right{display:flex;align-items:center;gap:0.6rem;}
.api-dot{width:8px;height:8px;border-radius:50%;background:var(--red);transition:background 0.3s;}
.api-dot.ok{background:var(--green);}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tabs{
  display:flex;background:var(--s1);border-bottom:1px solid var(--border);
  overflow-x:auto;scrollbar-width:none;position:sticky;top:57px;z-index:190;
}
.tabs::-webkit-scrollbar{display:none;}
.tab{
  flex:1;min-width:65px;padding:0.8rem 0.3rem;border:none;background:transparent;
  color:var(--muted);font-family:'Bricolage Grotesque',sans-serif;font-size:0.65rem;
  font-weight:700;text-transform:uppercase;letter-spacing:0.07em;cursor:pointer;
  border-bottom:2px solid transparent;transition:all 0.2s;white-space:nowrap;
  display:flex;flex-direction:column;align-items:center;gap:0.2rem;
}
.tab .t-icon{font-size:1.1rem;}
.tab.active{color:var(--green);border-bottom-color:var(--green);}

/* ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ */
.panel{display:none;padding:1rem;}
.panel.active{display:block;animation:fadeUp 0.25s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{
  background:var(--s1);border:1px solid var(--border);border-radius:14px;
  padding:1.1rem;margin-bottom:0.9rem;
}
.card-title{
  font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.12em;
  color:var(--muted2);margin-bottom:0.9rem;
}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:0.7rem;margin-bottom:0.9rem;}
.stat-box{
  background:var(--s1);border:1px solid var(--border);border-radius:14px;
  padding:1rem 0.9rem;position:relative;overflow:hidden;
}
.stat-box::before{
  content:'';position:absolute;top:-20px;right:-20px;
  width:70px;height:70px;border-radius:50%;opacity:0.08;
}
.stat-box.green::before{background:var(--green);}
.stat-box.red::before{background:var(--red);}
.stat-box.yellow::before{background:var(--yellow);}
.stat-box.blue::before{background:var(--blue);}
.stat-val{
  font-family:'Instrument Serif',serif;font-size:1.9rem;line-height:1;
  margin-bottom:0.2rem;
}
.stat-box.green .stat-val{color:var(--green);}
.stat-box.red .stat-val{color:var(--red);}
.stat-box.yellow .stat-val{color:var(--yellow);}
.stat-box.blue .stat-val{color:var(--blue);}
.stat-lbl{font-size:0.68rem;color:var(--muted2);font-weight:600;text-transform:uppercase;letter-spacing:0.06em;}

.activity-item{
  display:flex;align-items:center;gap:0.8rem;padding:0.7rem 0;
  border-bottom:1px solid var(--border);
}
.activity-item:last-child{border-bottom:none;}
.act-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.act-info{flex:1;min-width:0;}
.act-name{font-size:0.85rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.act-sub{font-size:0.72rem;color:var(--muted2);}
.act-badge{
  font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.06em;
  padding:0.25rem 0.6rem;border-radius:50px;flex-shrink:0;
}

/* ‚îÄ‚îÄ ARTICLES LIST ‚îÄ‚îÄ */
.article-card{
  background:var(--s1);border:1px solid var(--border);border-radius:14px;
  padding:1rem;margin-bottom:0.8rem;transition:border-color 0.2s;
  cursor:pointer;
}
.article-card:hover{border-color:var(--border2);}
.article-header{display:flex;justify-content:space-between;align-items:flex-start;gap:0.5rem;margin-bottom:0.6rem;}
.article-name{font-size:0.95rem;font-weight:700;line-height:1.3;}
.article-brand{font-size:0.75rem;color:var(--muted2);}
.article-footer{display:flex;justify-content:space-between;align-items:center;margin-top:0.7rem;}
.article-price{font-family:'Instrument Serif',serif;font-size:1.3rem;}
.article-profit{font-size:0.75rem;}
.article-profit.pos{color:var(--green);}
.article-profit.neg{color:var(--red);}
.article-days{font-size:0.68rem;color:var(--muted);}

.status-badge{
  font-size:0.6rem;font-weight:800;text-transform:uppercase;letter-spacing:0.08em;
  padding:0.25rem 0.65rem;border-radius:50px;white-space:nowrap;
}
.status-online{background:var(--green-d);color:var(--green);}
.status-reserved{background:var(--yellow-d);color:var(--yellow);}
.status-sold{background:var(--blue-d);color:var(--blue);}
.status-archived{background:var(--s3);color:var(--muted2);}

.filter-bar{display:flex;gap:0.5rem;overflow-x:auto;scrollbar-width:none;padding-bottom:0.3rem;margin-bottom:0.9rem;}
.filter-bar::-webkit-scrollbar{display:none;}
.filter-btn{
  padding:0.4rem 0.9rem;border-radius:50px;border:1.5px solid var(--border);
  background:transparent;color:var(--muted2);font-family:'Bricolage Grotesque',sans-serif;
  font-size:0.72rem;font-weight:700;cursor:pointer;white-space:nowrap;transition:all 0.2s;
}
.filter-btn.active{background:var(--green);border-color:var(--green);color:#0A0A0B;}

/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.field{margin-bottom:0.85rem;}
.field label{
  display:block;font-size:0.65rem;font-weight:800;text-transform:uppercase;
  letter-spacing:0.1em;color:var(--muted2);margin-bottom:0.35rem;
}
input,select,textarea{
  width:100%;font-family:'Bricolage Grotesque',sans-serif;font-size:0.95rem;
  color:var(--text);background:var(--s2);border:1.5px solid var(--border);
  border-radius:10px;padding:0.65rem 0.9rem;outline:none;transition:border-color 0.2s;
  -webkit-appearance:none;
}
input:focus,select:focus,textarea:focus{border-color:var(--green);}
select option{background:var(--s2);}
textarea{resize:vertical;min-height:70px;line-height:1.6;}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:0.7rem;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{
  width:100%;padding:0.9rem;border:none;border-radius:12px;
  font-family:'Bricolage Grotesque',sans-serif;font-size:0.9rem;font-weight:800;
  cursor:pointer;transition:all 0.15s;letter-spacing:0.02em;
}
.btn-primary{background:var(--green);color:#0A0A0B;}
.btn-primary:hover{background:var(--green-m);}
.btn-primary:active{transform:scale(0.98);}
.btn-primary:disabled{opacity:0.35;cursor:wait;}
.btn-ghost{background:transparent;border:1.5px solid var(--border);color:var(--muted2);font-size:0.8rem;padding:0.6rem;}
.btn-ghost:hover{border-color:var(--green);color:var(--green);}
.btn-danger{background:var(--red-d);border:1px solid var(--red);color:var(--red);font-size:0.8rem;padding:0.6rem;}

/* ‚îÄ‚îÄ AI SECTION ‚îÄ‚îÄ */
.ai-bar{
  background:var(--s2);border:1px dashed var(--border2);border-radius:10px;
  padding:0.8rem 1rem;margin-bottom:0.9rem;display:flex;gap:0.6rem;align-items:center;
}
.ai-bar input{background:transparent;border:none;padding:0;font-size:0.85rem;flex:1;}
.ai-bar input:focus{border:none;box-shadow:none;}
.key-pill{
  font-size:0.62rem;font-weight:800;text-transform:uppercase;letter-spacing:0.08em;
  padding:0.2rem 0.55rem;border-radius:6px;background:var(--red-d);color:var(--red);
  white-space:nowrap;transition:all 0.3s;
}
.key-pill.ok{background:var(--green-d);color:var(--green);}

.pills{display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:0.9rem;}
.pill{
  padding:0.35rem 0.85rem;border-radius:50px;border:1.5px solid var(--border);
  background:transparent;color:var(--muted2);font-family:'Bricolage Grotesque',sans-serif;
  font-size:0.75rem;font-weight:700;cursor:pointer;transition:all 0.15s;
}
.pill:hover{border-color:var(--green);color:var(--green);}
.pill.active{background:var(--green);border-color:var(--green);color:#0A0A0B;}

/* ‚îÄ‚îÄ RESULT ‚îÄ‚îÄ */
.result-card{
  background:var(--s1);border:1px solid var(--green);border-radius:14px;
  overflow:hidden;margin-top:1rem;animation:fadeUp 0.3s ease;
}
.result-head{
  padding:0.7rem 1rem;background:var(--green-d);
  display:flex;justify-content:space-between;align-items:center;
  border-bottom:1px solid var(--green);
}
.result-head span{font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--green);}
.result-body{padding:1rem;white-space:pre-wrap;font-size:0.88rem;line-height:1.75;color:var(--text);}
.copy-btn{
  background:var(--green);color:#0A0A0B;border:none;padding:0.3rem 0.8rem;
  border-radius:7px;font-family:'Bricolage Grotesque',sans-serif;font-size:0.7rem;
  font-weight:800;cursor:pointer;transition:opacity 0.2s;
}
.save-to-article-btn{
  width:100%;margin-top:0;padding:0.7rem;background:var(--s2);
  border:1px solid var(--border);border-top:none;color:var(--muted2);
  font-family:'Bricolage Grotesque',sans-serif;font-size:0.78rem;font-weight:700;
  cursor:pointer;transition:all 0.2s;
}
.save-to-article-btn:hover{color:var(--green);background:var(--green-d);}

/* ‚îÄ‚îÄ PRICE CALC ‚îÄ‚îÄ */
.price-grid{display:grid;grid-template-columns:1fr 1fr;gap:0.7rem;margin-top:0.9rem;}
.p-box{
  background:var(--s2);border:1px solid var(--border);border-radius:12px;
  padding:0.85rem;text-align:center;
}
.p-box.g{border-color:var(--green);background:var(--green-d);}
.p-box.r{border-color:var(--red);background:var(--red-d);}
.p-box.y{border-color:var(--yellow);background:var(--yellow-d);}
.p-box.p{border-color:var(--purple);background:#1a1030;}
.p-val{font-family:'Instrument Serif',serif;font-size:1.7rem;line-height:1;}
.p-box.g .p-val{color:var(--green);}
.p-box.r .p-val{color:var(--red);}
.p-box.y .p-val{color:var(--yellow);}
.p-box.p .p-val{color:var(--purple);}
.p-lbl{font-size:0.6rem;font-weight:800;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted2);margin-top:0.25rem;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);
  z-index:500;display:none;align-items:flex-end;
}
.modal-overlay.open{display:flex;animation:fadeIn 0.2s ease;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
.modal{
  background:var(--s1);border:1px solid var(--border);border-radius:20px 20px 0 0;
  width:100%;max-height:90vh;overflow-y:auto;padding:1.2rem;
  animation:slideUp 0.3s ease;
}
@keyframes slideUp{from{transform:translateY(100%);}to{transform:translateY(0);}}
.modal-handle{
  width:40px;height:4px;background:var(--border2);border-radius:2px;
  margin:0 auto 1.2rem;
}
.modal-title{
  font-family:'Instrument Serif',serif;font-size:1.4rem;margin-bottom:1.2rem;
  display:flex;justify-content:space-between;align-items:center;
}
.modal-close{
  background:var(--s2);border:none;color:var(--muted2);width:32px;height:32px;
  border-radius:50%;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;
}

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
.loading{display:flex;align-items:center;gap:0.6rem;padding:1rem;color:var(--muted2);font-size:0.85rem;}
.spinner{
  width:18px;height:18px;border:2px solid var(--border);
  border-top-color:var(--green);border-radius:50%;animation:spin 0.7s linear infinite;flex-shrink:0;
}
@keyframes spin{to{transform:rotate(360deg);}}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{
  position:fixed;bottom:5.5rem;left:50%;transform:translateX(-50%) translateY(20px);
  background:var(--green);color:#0A0A0B;padding:0.55rem 1.3rem;border-radius:50px;
  font-size:0.8rem;font-weight:800;opacity:0;transition:all 0.3s;pointer-events:none;z-index:999;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bnav{
  position:fixed;bottom:0;left:0;right:0;background:rgba(10,10,11,0.95);
  backdrop-filter:blur(20px);border-top:1px solid var(--border);
  display:flex;padding:0.5rem 0 0.7rem;z-index:300;
}
.bnav button{
  flex:1;background:transparent;border:none;color:var(--muted);
  font-family:'Bricolage Grotesque',sans-serif;font-size:0.58rem;font-weight:800;
  text-transform:uppercase;letter-spacing:0.07em;cursor:pointer;padding:0.3rem;
  display:flex;flex-direction:column;align-items:center;gap:0.25rem;transition:color 0.2s;
}
.bnav button .ni{font-size:1.2rem;}
.bnav button.active{color:var(--green);}

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty{text-align:center;padding:3rem 1rem;color:var(--muted);}
.empty .ei{font-size:2.5rem;margin-bottom:0.7rem;}
.empty p{font-size:0.85rem;line-height:1.6;}

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.prog-bar{height:5px;background:var(--border);border-radius:3px;overflow:hidden;margin-top:0.8rem;}
.prog-fill{height:100%;border-radius:3px;background:var(--green);transition:width 0.5s ease;}
.prog-fill.neg{background:var(--red);width:100%!important;}

/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.section-header{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:0.9rem;
}
.section-title{font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted2);}
.section-action{
  background:var(--green);color:#0A0A0B;border:none;padding:0.4rem 0.9rem;
  border-radius:8px;font-family:'Bricolage Grotesque',sans-serif;font-size:0.72rem;
  font-weight:800;cursor:pointer;
}

/* ‚îÄ‚îÄ ARTICLE DETAIL ‚îÄ‚îÄ */
.detail-actions{display:grid;grid-template-columns:1fr 1fr;gap:0.6rem;margin-top:0.9rem;}
.status-select-row{display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:0.6rem;}
.status-opt{
  padding:0.35rem 0.8rem;border-radius:50px;border:1.5px solid var(--border);
  background:transparent;color:var(--muted2);font-family:'Bricolage Grotesque',sans-serif;
  font-size:0.72rem;font-weight:700;cursor:pointer;transition:all 0.15s;
}
.status-opt:hover{border-color:var(--border2);}
.status-opt.active-online{background:var(--green-d);border-color:var(--green);color:var(--green);}
.status-opt.active-reserved{background:var(--yellow-d);border-color:var(--yellow);color:var(--yellow);}
.status-opt.active-sold{background:var(--blue-d);border-color:var(--blue);color:var(--blue);}
.status-opt.active-archived{background:var(--s3);border-color:var(--border2);color:var(--muted2);}

.note-area{
  background:var(--s2);border:1px solid var(--border);border-radius:10px;
  padding:0.8rem;font-size:0.85rem;color:var(--text);min-height:60px;
  line-height:1.6;white-space:pre-wrap;
}

/* ‚îÄ‚îÄ CHART MINI ‚îÄ‚îÄ */
.mini-chart{display:flex;align-items:flex-end;gap:3px;height:50px;margin-top:0.8rem;}
.bar-col{flex:1;background:var(--green-d);border-radius:3px 3px 0 0;min-height:4px;transition:height 0.5s ease;}
.bar-col:hover{background:var(--green);}
.chart-labels{display:flex;justify-content:space-between;margin-top:0.3rem;}
.chart-label{font-size:0.58rem;color:var(--muted);text-align:center;flex:1;}

/* ‚îÄ‚îÄ PHOTO ‚îÄ‚îÄ */
.photo-thumb {
  width:100%;height:160px;object-fit:cover;border-radius:10px;
  background:var(--s2);display:block;margin-bottom:0.8rem;
  border:1px solid var(--border);
}
.photo-placeholder {
  width:100%;height:100px;background:var(--s2);border:1.5px dashed var(--border2);
  border-radius:10px;display:flex;align-items:center;justify-content:center;
  flex-direction:column;gap:0.3rem;cursor:pointer;transition:border-color 0.2s;
  color:var(--muted);font-size:0.78rem;font-weight:600;
}
.photo-placeholder:hover{border-color:var(--green);color:var(--green);}
.photo-placeholder .ph-icon{font-size:1.5rem;}

/* ‚îÄ‚îÄ ALERT BADGE ‚îÄ‚îÄ */
.alert-dot {
  display:inline-block;width:7px;height:7px;border-radius:50%;
  background:var(--yellow);margin-left:0.3rem;vertical-align:middle;
  animation:pulse 1.5s infinite;
}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.3;}}

/* ‚îÄ‚îÄ GOAL BAR ‚îÄ‚îÄ */
.goal-bar-wrap{margin-top:0.8rem;}
.goal-bar{height:8px;background:var(--border);border-radius:50px;overflow:hidden;}
.goal-bar-fill{height:100%;border-radius:50px;background:var(--green);transition:width 0.6s ease;}
.goal-bar-fill.over{background:var(--yellow);}
.goal-labels{display:flex;justify-content:space-between;font-size:0.68rem;color:var(--muted2);margin-top:0.4rem;}

/* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
.search-bar{
  display:flex;align-items:center;gap:0.6rem;background:var(--s2);
  border:1.5px solid var(--border);border-radius:10px;padding:0.6rem 0.9rem;
  margin-bottom:0.9rem;
}
.search-bar input{background:transparent;border:none;padding:0;font-size:0.9rem;flex:1;color:var(--text);}
.search-bar input::placeholder{color:var(--muted);}
.search-bar input:focus{border:none;box-shadow:none;}
.search-bar .s-icon{color:var(--muted);font-size:1rem;}

/* ‚îÄ‚îÄ STATS DETAIL ‚îÄ‚îÄ */
.stat-row{display:flex;justify-content:space-between;align-items:center;padding:0.55rem 0;border-bottom:1px solid var(--border);}
.stat-row:last-child{border-bottom:none;}
.stat-row-lbl{font-size:0.82rem;color:var(--muted2);}
.stat-row-val{font-size:0.9rem;font-weight:700;}

/* ‚îÄ‚îÄ QUICK ADD ‚îÄ‚îÄ */
.quick-pill{
  display:inline-flex;align-items:center;gap:0.4rem;
  background:var(--green-d);border:1px solid var(--green);color:var(--green);
  border-radius:50px;padding:0.3rem 0.8rem;font-size:0.72rem;font-weight:700;
  cursor:pointer;margin-bottom:0.5rem;
}

/* ‚îÄ‚îÄ TEMPLATES ‚îÄ‚îÄ */
.template-item {
  background:var(--s2);border:1px solid var(--border);border-radius:10px;
  padding:0.8rem;margin-bottom:0.6rem;cursor:pointer;transition:border-color 0.2s;
}
.template-item:hover{border-color:var(--green);}
.template-name{font-size:0.85rem;font-weight:700;margin-bottom:0.25rem;}
.template-preview{font-size:0.72rem;color:var(--muted2);overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;}
.template-actions{display:flex;gap:0.4rem;margin-top:0.6rem;}
.tpl-btn{
  padding:0.25rem 0.7rem;border-radius:6px;border:1px solid var(--border);
  background:transparent;color:var(--muted2);font-family:'Bricolage Grotesque',sans-serif;
  font-size:0.68rem;font-weight:700;cursor:pointer;transition:all 0.15s;
}
.tpl-btn.use{background:var(--green-d);border-color:var(--green);color:var(--green);}
.tpl-btn.del{border-color:var(--red-d);color:var(--red);}

/* ‚îÄ‚îÄ SORT ‚îÄ‚îÄ */
.sort-bar{display:flex;gap:0.4rem;align-items:center;margin-bottom:0.7rem;overflow-x:auto;scrollbar-width:none;}
.sort-bar::-webkit-scrollbar{display:none;}
.sort-btn{
  padding:0.3rem 0.75rem;border-radius:50px;border:1.5px solid var(--border);
  background:transparent;color:var(--muted2);font-family:'Bricolage Grotesque',sans-serif;
  font-size:0.68rem;font-weight:700;cursor:pointer;white-space:nowrap;transition:all 0.15s;
  display:flex;align-items:center;gap:0.25rem;
}
.sort-btn.active{border-color:var(--green);color:var(--green);}
.sort-lbl{font-size:0.62rem;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:0.08em;white-space:nowrap;padding-top:0.1rem;}
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="logo" style="line-height:1.1;">VintedCRM<br><span style="font-family:'Bricolage Grotesque',sans-serif;font-size:0.55rem;font-weight:600;color:var(--muted);letter-spacing:0.05em;text-transform:uppercase;">de ps6chik ¬∑ by Claude</span></div>
  <div class="header-right">
    <div class="api-dot" id="apiDot"></div>
    <button class="btn-ghost" style="width:auto;padding:0.35rem 0.8rem;font-size:0.7rem;" onclick="openModal('modal-settings')">‚öôÔ∏è Config</button>
  </div>
</div>

<!-- TABS -->
<div class="tabs">
  <button class="tab active" onclick="showTab('dashboard',0)" id="t0"><span class="t-icon">üìä</span>Dashboard</button>
  <button class="tab" onclick="showTab('articles',1)" id="t1"><span class="t-icon">üëï</span>Articles</button>
  <button class="tab" onclick="showTab('generate',2)" id="t2"><span class="t-icon">‚úçÔ∏è</span>IA</button>
  <button class="tab" onclick="showTab('price',3)" id="t3"><span class="t-icon">üí∂</span>Prix</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel active" id="panel-dashboard">
  <div class="stats-grid" id="statsGrid">
    <div class="stat-box green"><div class="stat-val" id="statRevenu">0‚Ç¨</div><div class="stat-lbl">Revenus nets</div></div>
    <div class="stat-box blue"><div class="stat-val" id="statVendus">0</div><div class="stat-lbl">Articles vendus</div></div>
    <div class="stat-box yellow"><div class="stat-val" id="statEnLigne">0</div><div class="stat-lbl">En ligne</div></div>
    <div class="stat-box red" style="cursor:pointer;" onclick="openModal('modal-stats')">
      <div class="stat-val" id="statUrssaf">0‚Ç¨</div>
      <div class="stat-lbl">URSSAF ce mois</div>
    </div>
  </div>

  <div class="card" id="weeklyRecapCard" style="display:none;">
    <div class="card-title" style="display:flex;justify-content:space-between;align-items:center;">
      <span>üìÖ R√©cap de la semaine</span>
      <button onclick="document.getElementById('weeklyRecapCard').style.display='none'" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.72rem;">‚úï</button>
    </div>
    <div id="weeklyRecapContent"></div>
  </div>

  <div class="card">
    <div class="card-title" style="display:flex;justify-content:space-between;align-items:center;">
      <span>Objectif du mois</span>
      <button onclick="openModal('modal-goal')" style="background:none;border:none;color:var(--muted2);cursor:pointer;font-size:0.75rem;font-weight:700;">‚úèÔ∏è Modifier</button>
    </div>
    <div id="goalWidget"></div>
  </div>

  <div class="card">
    <div class="card-title">B√©n√©fice mensuel</div>
    <div class="mini-chart" id="miniChart"></div>
    <div class="chart-labels" id="chartLabels"></div>
  </div>

  <div class="card">
    <div class="card-title" style="display:flex;justify-content:space-between;align-items:center;">
      <span>Activit√© r√©cente</span>
      <button onclick="openStatsModal()" style="background:none;border:none;color:var(--green);cursor:pointer;font-size:0.72rem;font-weight:700;">üìà Stats d√©taill√©es</button>
    </div>
    <div id="activityFeed">
      <div class="empty"><div class="ei">üì≠</div><p>Aucune activit√© pour l'instant.<br>Ajoute ton premier article !</p></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ARTICLES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-articles">
  <div class="section-header">
    <div class="section-title"><span id="articleCount">0</span> article(s)</div>
    <div style="display:flex;gap:0.5rem;">
      <button class="btn-ghost" style="padding:0.4rem 0.8rem;font-size:0.72rem;width:auto;border-radius:8px;" onclick="openModal('modal-quick-add')">‚ö° Rapide</button>
      <button class="section-action" onclick="openModal('modal-add')">+ Complet</button>
    </div>
  </div>

  <div class="sort-bar">
    <span class="sort-lbl">Trier :</span>
    <button class="sort-btn active" data-sort="date-desc" onclick="setSort(this,'date-desc')">üìÖ R√©cent</button>
    <button class="sort-btn" data-sort="date-asc" onclick="setSort(this,'date-asc')">üìÖ Ancien</button>
    <button class="sort-btn" data-sort="price-desc" onclick="setSort(this,'price-desc')">üí∂ Prix ‚Üì</button>
    <button class="sort-btn" data-sort="price-asc" onclick="setSort(this,'price-asc')">üí∂ Prix ‚Üë</button>
    <button class="sort-btn" data-sort="profit-desc" onclick="setSort(this,'profit-desc')">‚ú¶ B√©n√©f ‚Üì</button>
    <button class="sort-btn" data-sort="days-desc" onclick="setSort(this,'days-desc')">‚è± D√©lai ‚Üì</button>
  </div>

  <div class="search-bar">
    <span class="s-icon">üîç</span>
    <input type="text" id="searchInput" placeholder="Rechercher par nom, marque, taille‚Ä¶" oninput="renderArticles()">
  </div>
  <div class="filter-bar">
    <button class="filter-btn active" data-filter="all" onclick="setFilter(this,'all')">Tous</button>
    <button class="filter-btn" data-filter="online" onclick="setFilter(this,'online')">En ligne</button>
    <button class="filter-btn" data-filter="reserved" onclick="setFilter(this,'reserved')">R√©serv√©</button>
    <button class="filter-btn" data-filter="sold" onclick="setFilter(this,'sold')">Vendus</button>
    <button class="filter-btn" data-filter="archived" onclick="setFilter(this,'archived')">Archiv√©s</button>
  </div>

  <div id="articlesList"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GENERATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-generate">
  <div class="ai-bar">
    <span>üîë</span>
    <input type="password" id="apiKeyInput" placeholder="Cl√© API Anthropic (sk-ant-‚Ä¶)" autocomplete="off">
    <span class="key-pill" id="keyPill">OFF</span>
  </div>

  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.6rem;">
    <div class="card-title" style="margin:0;">Style de description</div>
    <button onclick="openModal('modal-templates')" style="background:none;border:none;color:var(--green);cursor:pointer;font-size:0.72rem;font-weight:700;">üìã Mes mod√®les</button>
  </div>
  <div class="pills">
    <button class="pill active" data-tone="casual">Casual</button>
    <button class="pill" data-tone="chic">Chic</button>
    <button class="pill" data-tone="punchy">Punchy</button>
    <button class="pill" data-tone="detailed">D√©taill√©</button>
  </div>

  <div class="card">
    <div class="card-title">D√©cris ton article</div>
    <textarea id="freeInput" placeholder="Ex : cardigan norv√©gien Dewold taille M bon √©tat, port√© 2-3 fois, coloris cr√®me‚Ä¶" style="min-height:120px;"></textarea>
    <div style="font-size:0.7rem;color:var(--muted);margin-top:0.5rem;">√âcris librement, l'IA structure tout.</div>
  </div>

  <button class="btn btn-primary" id="genBtn" onclick="generateDesc()">‚ú¶ G√©n√©rer la description</button>
  <button class="btn btn-ghost" style="margin-top:0.5rem;" onclick="saveAsTemplate()">üíæ Sauvegarder comme mod√®le</button>
  <div id="genResult"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PRICE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-price">
  <div class="card">
    <div class="card-title">Calculateur de rentabilit√©</div>
    <div class="field"><label>Prix d'achat (‚Ç¨)</label><input type="number" id="pBuy" min="0" placeholder="0" oninput="calcPrice()"></div>
    <div class="field"><label>Prix de vente Vinted (‚Ç¨)</label><input type="number" id="pSell" min="0" placeholder="0" oninput="calcPrice()"></div>
    <div style="font-size:0.7rem;color:var(--muted);line-height:1.6;">
      Port √† la charge de l'acheteur ¬∑ URSSAF 12,3% sur le prix de vente
    </div>
    <div class="price-grid" id="priceGrid" style="display:none;">
      <div class="p-box g"><div class="p-val" id="pvRevenu">‚Äî</div><div class="p-lbl">Tu re√ßois</div></div>
      <div class="p-box p"><div class="p-val" id="pvUrssaf">‚Äî</div><div class="p-lbl">URSSAF</div></div>
      <div class="p-box" id="pProfitBox"><div class="p-val" id="pvProfit">‚Äî</div><div class="p-lbl">B√©n√©fice net</div></div>
      <div class="p-box y"><div class="p-val" id="pvMargin">‚Äî</div><div class="p-lbl">Marge</div></div>
    </div>
    <div class="prog-bar" id="progBar" style="display:none;"><div class="prog-fill" id="progFill"></div></div>
  </div>

  <div class="card">
    <div class="card-title">Trouver le bon prix de vente</div>
    <div class="field"><label>Prix d'achat (‚Ç¨)</label><input type="number" id="sBuy" min="0" placeholder="0" oninput="calcSuggest()"></div>
    <div class="field"><label>B√©n√©fice net souhait√© (‚Ç¨)</label><input type="number" id="sProfit" min="0" placeholder="10" value="10" oninput="calcSuggest()"></div>
    <div id="suggestOut" style="display:none;text-align:center;margin-top:0.9rem;">
      <div style="font-size:0.65rem;color:var(--muted2);font-weight:800;text-transform:uppercase;letter-spacing:0.1em;">Prix √† afficher</div>
      <div id="suggestVal" style="font-family:'Instrument Serif',serif;font-size:3rem;color:var(--green);line-height:1.1;margin-top:0.3rem;"></div>
      <div id="suggestDetail" style="font-size:0.72rem;color:var(--muted2);margin-top:0.3rem;"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- ADD ARTICLE -->
<div class="modal-overlay" id="modal-add">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      Nouvel article
      <button class="modal-close" onclick="closeModal('modal-add')">‚úï</button>
    </div>
    <div class="field">
      <label>Photo</label>
      <div class="photo-placeholder" onclick="document.getElementById('aPhotoInput').click()">
        <span class="ph-icon">üì∑</span>
        <span>Ajouter une photo</span>
      </div>
      <img id="aPhotoPreview" class="photo-thumb" style="display:none;" alt="Photo article">
      <input type="file" id="aPhotoInput" accept="image/*" style="display:none;" onchange="handlePhoto(this)">
    </div>
    <div class="field"><label>Nom *</label><input type="text" id="aName" placeholder="Ex : Veste en jean Zara"></div>
    <div class="row2">
      <div class="field"><label>Marque</label><input type="text" id="aBrand" placeholder="Zara, Nike‚Ä¶"></div>
      <div class="field"><label>Taille</label><input type="text" id="aSize" placeholder="M, 38‚Ä¶"></div>
    </div>
    <div class="row2">
      <div class="field"><label>Prix d'achat (‚Ç¨)</label><input type="number" id="aBuyPrice" min="0" placeholder="0"></div>
      <div class="field"><label>Prix de vente (‚Ç¨)</label><input type="number" id="aSellPrice" min="0" placeholder="0"></div>
    </div>
    <div class="field">
      <label>√âtat</label>
      <select id="aCondition">
        <option>Neuf avec √©tiquette</option>
        <option selected>Neuf sans √©tiquette</option>
        <option>Tr√®s bon √©tat</option>
        <option>Bon √©tat</option>
        <option>Satisfaisant</option>
      </select>
    </div>
    <div class="field"><label>Notes publiques</label><textarea id="aNotes" placeholder="Couleur, mati√®re, √©tat visible‚Ä¶" style="min-height:60px;"></textarea></div>
    <div class="field">
      <label>üîí Note priv√©e <span style="font-size:0.6rem;color:var(--muted);font-weight:400;text-transform:none;letter-spacing:0;">(visible uniquement dans le CRM)</span></label>
      <textarea id="aPrivateNote" placeholder="Prix d'achat r√©el, d√©faut cach√©, source, anecdote‚Ä¶" style="min-height:60px;background:var(--s3);border-color:var(--border2);"></textarea>
    </div>
    <div class="field">
      <label>Statut</label>
      <select id="aStatus">
        <option value="online">En ligne</option>
        <option value="reserved">R√©serv√©</option>
        <option value="sold">Vendu</option>
        <option value="archived">Archiv√©</option>
      </select>
    </div>
    <button class="btn btn-primary" onclick="saveArticle()">Enregistrer l'article</button>
    <div style="height:0.5rem;"></div>
    <button class="btn btn-ghost" onclick="closeModal('modal-add')">Annuler</button>
  </div>
</div>

<!-- ARTICLE DETAIL -->
<div class="modal-overlay" id="modal-detail">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      <span id="detailName" style="font-size:1.3rem;">Article</span>
      <button class="modal-close" onclick="closeModal('modal-detail')">‚úï</button>
    </div>
    <div id="detailContent"></div>
  </div>
</div>

<!-- SETTINGS -->
<div class="modal-overlay" id="modal-settings">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      Configuration
      <button class="modal-close" onclick="closeModal('modal-settings')">‚úï</button>
    </div>
    <div class="field">
      <label>Cl√© API Anthropic</label>
      <input type="password" id="settingsKey" placeholder="sk-ant-‚Ä¶" autocomplete="off">
    </div>
    <div style="font-size:0.72rem;color:var(--muted);line-height:1.6;margin-bottom:1rem;">
      Obtiens ta cl√© sur <strong style="color:var(--text);">console.anthropic.com</strong><br>
      ~0,005‚Ç¨ par description g√©n√©r√©e
    </div>
    <button class="btn btn-primary" onclick="saveSettings()">Sauvegarder</button>
    <div style="margin-top:0.9rem;padding-top:0.9rem;border-top:1px solid var(--border);">
      <div class="card-title" style="margin-bottom:0.7rem;">Donn√©es</div>
      <div class="field" style="margin-bottom:0.6rem;">
        <label>Nom entreprise / auto-entrepreneur</label>
        <input type="text" id="settingsCompany" placeholder="Ex : Jean Dupont ‚Äî Auto-entrepreneur">
      </div>
      <button class="btn btn-danger" onclick="openExportModal()">üì§ Exporter CSV par mois</button>
      <div style="height:0.5rem;"></div>
      <button class="btn btn-ghost" onclick="backupData()">üíæ Sauvegarder mes donn√©es (JSON)</button>
      <div style="height:0.5rem;"></div>
      <button class="btn btn-ghost" onclick="document.getElementById('importInput').click()">üì• Restaurer une sauvegarde</button>
      <input type="file" id="importInput" accept=".json" style="display:none;" onchange="restoreData(this)">
      <div style="height:0.5rem;"></div>
      <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è R√©initialiser tout</button>
    </div>
  </div>
</div>


<!-- EXPORT CSV MODAL -->
<div class="modal-overlay" id="modal-export">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      Exporter CSV
      <button class="modal-close" onclick="closeModal('modal-export')">‚úï</button>
    </div>
    <div class="field">
      <label>Mois</label>
      <select id="exportMonth">
        <option value="0">Janvier</option><option value="1">F√©vrier</option>
        <option value="2">Mars</option><option value="3">Avril</option>
        <option value="4">Mai</option><option value="5">Juin</option>
        <option value="6">Juillet</option><option value="7">Ao√ªt</option>
        <option value="8">Septembre</option><option value="9">Octobre</option>
        <option value="10">Novembre</option><option value="11">D√©cembre</option>
      </select>
    </div>
    <div class="field">
      <label>Ann√©e</label>
      <select id="exportYear"></select>
    </div>
    <div id="exportPreview" style="font-size:0.8rem;color:var(--muted2);margin-bottom:1rem;padding:0.7rem;background:var(--s2);border-radius:8px;display:none;"></div>
    <button class="btn btn-primary" onclick="doExportCSV()">üì• T√©l√©charger le CSV</button>
    <div style="height:0.5rem;"></div>
    <button class="btn btn-ghost" onclick="closeModal('modal-export')">Annuler</button>
  </div>
</div>

<!-- INVOICE MODAL -->
<div class="modal-overlay" id="modal-invoice">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      G√©n√©rer une facture
      <button class="modal-close" onclick="closeModal('modal-invoice')">‚úï</button>
    </div>
    <div style="font-size:0.72rem;color:var(--muted2);margin-bottom:1rem;">Les infos article sont pr√©-remplies. Compl√®te les 2 champs manquants.</div>
    <div class="field">
      <label>üè¢ Votre nom / entreprise</label>
      <input type="text" id="invSeller" placeholder="Jean Dupont ‚Äî Auto-entrepreneur">
    </div>
    <div class="field">
      <label>üë§ Nom du client</label>
      <input type="text" id="invBuyer" placeholder="Nom de l'acheteur">
    </div>
    <div style="background:var(--s2);border:1px solid var(--border);border-radius:10px;padding:0.9rem;margin-bottom:1rem;">
      <div class="card-title" style="margin-bottom:0.7rem;">Aper√ßu facture</div>
      <div id="invPreview" style="font-size:0.82rem;line-height:1.8;color:var(--text);"></div>
    </div>
    <button class="btn btn-primary" onclick="printInvoice()">üñ®Ô∏è Imprimer / Sauvegarder PDF</button>
    <div style="height:0.5rem;"></div>
    <button class="btn btn-ghost" onclick="closeModal('modal-invoice')">Fermer</button>
  </div>
</div>


<!-- GOAL MODAL -->
<div class="modal-overlay" id="modal-goal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      Objectif mensuel
      <button class="modal-close" onclick="closeModal('modal-goal')">‚úï</button>
    </div>
    <div class="field">
      <label>B√©n√©fice net vis√© ce mois (‚Ç¨)</label>
      <input type="number" id="goalAmount" min="0" placeholder="Ex : 200">
    </div>
    <button class="btn btn-primary" onclick="saveGoal()">Enregistrer</button>
  </div>
</div>

<!-- STATS MODAL -->
<div class="modal-overlay" id="modal-stats">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      Statistiques
      <button class="modal-close" onclick="closeModal('modal-stats')">‚úï</button>
    </div>
    <div id="statsContent"></div>
  </div>
</div>


<!-- TEMPLATES MODAL -->
<div class="modal-overlay" id="modal-templates">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      Mes mod√®les
      <button class="modal-close" onclick="closeModal('modal-templates')">‚úï</button>
    </div>
    <div style="font-size:0.75rem;color:var(--muted2);margin-bottom:1rem;">
      Sauvegarde tes descriptions qui marchent bien. En un clic, elles pr√©-remplissent le champ texte.
    </div>
    <div id="templatesList"></div>
    <div id="templatesEmpty" style="display:none;">
      <div class="empty"><div class="ei">üìã</div><p>Aucun mod√®le sauvegard√©.<br>Remplis le champ texte dans l'onglet IA<br>et clique sur "Sauvegarder comme mod√®le".</p></div>
    </div>
  </div>
</div>

<!-- SAVE TEMPLATE MODAL -->
<div class="modal-overlay" id="modal-save-template">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      Nouveau mod√®le
      <button class="modal-close" onclick="closeModal('modal-save-template')">‚úï</button>
    </div>
    <div class="field">
      <label>Nom du mod√®le</label>
      <input type="text" id="templateName" placeholder="Ex : T-shirt vintage, Veste streetwear‚Ä¶">
    </div>
    <div style="font-size:0.72rem;color:var(--muted2);margin-bottom:1rem;" id="templateTextPreview"></div>
    <button class="btn btn-primary" onclick="confirmSaveTemplate()">Sauvegarder</button>
    <div style="height:0.5rem;"></div>
    <button class="btn btn-ghost" onclick="closeModal('modal-save-template')">Annuler</button>
  </div>
</div>


<!-- QUICK ADD MODAL -->
<div class="modal-overlay" id="modal-quick-add">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">
      ‚ö° Ajout rapide
      <button class="modal-close" onclick="closeModal('modal-quick-add')">‚úï</button>
    </div>
    <div style="font-size:0.72rem;color:var(--muted2);margin-bottom:1rem;">Juste le nom et le prix ‚Äî tu compl√®tes plus tard si besoin.</div>
    <div class="field"><label>Nom *</label><input type="text" id="qName" placeholder="Ex : Veste Carhartt Detroit"></div>
    <div class="row2">
      <div class="field"><label>Prix de vente (‚Ç¨)</label><input type="number" id="qSellPrice" min="0" placeholder="0"></div>
      <div class="field"><label>Prix d'achat (‚Ç¨)</label><input type="number" id="qBuyPrice" min="0" placeholder="0"></div>
    </div>
    <div class="field">
      <label>Statut</label>
      <select id="qStatus">
        <option value="online">En ligne</option>
        <option value="reserved">R√©serv√©</option>
        <option value="sold">Vendu</option>
      </select>
    </div>
    <button class="btn btn-primary" onclick="saveQuickArticle()">‚ö° Ajouter</button>
    <div style="height:0.5rem;"></div>
    <button class="btn btn-ghost" onclick="closeModal('modal-quick-add')">Annuler</button>
  </div>
</div>

<!-- BOTTOM NAV -->
<div class="bnav">
  <button class="active" onclick="showTab('dashboard',0)" id="n0"><span class="ni">üìä</span>Dashboard</button>
  <button onclick="showTab('articles',1)" id="n1"><span class="ni">üëï</span>Articles</button>
  <button onclick="showTab('generate',2)" id="n2"><span class="ni">‚úçÔ∏è</span>IA</button>
  <button onclick="showTab('price',3)" id="n3"><span class="ni">üí∂</span>Prix</button>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let articles = [];
let currentFilter = 'all';
let editingId = null;

const STATUS_LABELS = { online:'En ligne', reserved:'R√©serv√©', sold:'Vendu', archived:'Archiv√©' };
const STATUS_CLASS  = { online:'status-online', reserved:'status-reserved', sold:'status-sold', archived:'status-archived' };
const STATUS_DOT    = { online:'#00E5A0', reserved:'#FFD166', sold:'#60A5FA', archived:'#5A5A70' };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function load() {
  try { articles = JSON.parse(localStorage.getItem('vcrm_articles') || '[]'); } catch { articles = []; }
}
function save() {
  localStorage.setItem('vcrm_articles', JSON.stringify(articles));
}
function getKey() { return localStorage.getItem('vcrm_apikey') || ''; }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showTab(name, idx) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.bnav button').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  document.getElementById('t' + idx).classList.add('active');
  document.getElementById('n' + idx).classList.add('active');
  if (name === 'dashboard') renderDashboard();
  if (name === 'articles') renderArticles();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(id) {
  document.getElementById(id).classList.add('open');
  if (id === 'modal-add' && !editingId) resetAddForm();
  if (id === 'modal-settings') {
    document.getElementById('settingsKey').value = getKey();
    document.getElementById('settingsCompany').value = localStorage.getItem('vcrm_company') || '';
  }
  if (id === 'modal-templates') renderTemplates();
}
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
  if (id === 'modal-add') { editingId = null; resetAddForm(); }
}
document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('open'); });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ARTICLE CRUD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function resetAddForm() {
  ['aName','aBrand','aSize','aNotes','aPrivateNote'].forEach(id => document.getElementById(id).value = '');
  ['aBuyPrice','aSellPrice'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('aCondition').value = 'Neuf sans √©tiquette';
  currentPhotoData = null;
  document.getElementById('aPhotoPreview').style.display = 'none';
  document.querySelector('.photo-placeholder').style.display = 'flex';
  document.getElementById('aStatus').value = 'online';
  document.querySelector('.modal-title').childNodes[0].textContent = 'Nouvel article';
}

function saveArticle() {
  const name = document.getElementById('aName').value.trim();
  if (!name) { showToast('‚ö†Ô∏è Renseigne le nom'); return; }

  const article = {
    id: editingId || Date.now().toString(),
    name,
    brand: document.getElementById('aBrand').value.trim(),
    size: document.getElementById('aSize').value.trim(),
    buyPrice: parseFloat(document.getElementById('aBuyPrice').value) || 0,
    sellPrice: parseFloat(document.getElementById('aSellPrice').value) || 0,
    condition: document.getElementById('aCondition').value,
    notes: document.getElementById('aNotes').value.trim(),
    privateNote: document.getElementById('aPrivateNote').value.trim(),
    status: document.getElementById('aStatus').value,
    photo: currentPhotoData || (editingId ? (articles.find(a => a.id === editingId)?.photo || null) : null),
    description: editingId ? (articles.find(a => a.id === editingId)?.description || '') : '',
    createdAt: editingId ? (articles.find(a => a.id === editingId)?.createdAt || new Date().toISOString()) : new Date().toISOString(),
    updatedAt: new Date().toISOString(),
    soldAt: document.getElementById('aStatus').value === 'sold' ? new Date().toISOString() : null,
  };

  if (editingId) {
    const idx = articles.findIndex(a => a.id === editingId);
    if (idx !== -1) articles[idx] = { ...articles[idx], ...article };
  } else {
    articles.unshift(article);
  }

  save();
  closeModal('modal-add');
  renderArticles();
  renderDashboard();
  showToast(editingId ? '‚úì Article modifi√©' : '‚úì Article ajout√©');
  editingId = null;
}

function openDetail(id) {
  const a = articles.find(x => x.id === id);
  if (!a) return;
  document.getElementById('detailName').textContent = a.name;

  const urssaf = a.sellPrice * 0.123;
  const profit = a.sellPrice - urssaf - a.buyPrice;
  const days = Math.floor((Date.now() - new Date(a.createdAt)) / 86400000);

  document.getElementById('detailContent').innerHTML = `
    <div style="display:flex;gap:0.5rem;align-items:center;margin-bottom:1rem;">
      ${a.brand ? `<span style="font-size:0.78rem;color:var(--muted2);font-weight:600;">${a.brand}</span>` : ''}
      ${a.size ? `<span style="font-size:0.72rem;background:var(--s2);padding:0.2rem 0.6rem;border-radius:6px;color:var(--muted2);">${a.size}</span>` : ''}
      <span class="status-badge ${STATUS_CLASS[a.status]}">${STATUS_LABELS[a.status]}</span>
    </div>

    <div style="font-size:0.65rem;color:var(--muted2);font-weight:800;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.5rem;">Changer le statut</div>
    <div class="status-select-row">
      ${['online','reserved','sold','archived'].map(s => `
        <button class="status-opt ${a.status === s ? 'active-'+s : ''}" onclick="changeStatus('${id}','${s}')">${STATUS_LABELS[s]}</button>
      `).join('')}
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.6rem;margin-top:1rem;">
      <div class="p-box"><div class="p-val" style="color:var(--text);font-size:1.4rem;">${a.sellPrice.toFixed(2)}‚Ç¨</div><div class="p-lbl">Prix vente</div></div>
      <div class="p-box ${profit >= 0 ? 'g' : 'r'}"><div class="p-val" style="font-size:1.4rem;">${profit >= 0 ? '+' : ''}${profit.toFixed(2)}‚Ç¨</div><div class="p-lbl">B√©n√©fice net</div></div>
    </div>

    <div style="margin-top:1rem;">
      <div style="font-size:0.65rem;color:var(--muted2);font-weight:800;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.5rem;">√âtat & infos</div>
      <div style="font-size:0.85rem;color:var(--muted2);">${a.condition}${a.notes ? ' ¬∑ ' + a.notes : ''}</div>
    ${a.privateNote ? '<div style="margin-top:0.6rem;background:var(--s3);border:1px solid var(--border2);border-radius:8px;padding:0.6rem 0.8rem;"><span style="font-size:0.6rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted2);">üîí Note priv√©e</span><div style="font-size:0.82rem;color:var(--text);margin-top:0.2rem;">'+escHtml(a.privateNote)+'</div></div>' : ''}
      <div style="font-size:0.72rem;color:var(--muted);margin-top:0.3rem;">Ajout√© il y a ${days} jour(s)</div>
    </div>

    ${a.description ? `
    <div style="margin-top:1rem;">
      <div style="font-size:0.65rem;color:var(--muted2);font-weight:800;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.5rem;">Description Vinted</div>
      <div class="note-area">${escHtml(a.description)}</div>
      <button class="btn btn-ghost" style="margin-top:0.5rem;" onclick="copyText('${id}')">Copier la description</button>
    </div>` : `
    <div style="margin-top:1rem;">
      <button class="btn btn-ghost" onclick="closeModal('modal-detail');showTab('generate',2);prefillGenerate('${id}')">
        ‚úçÔ∏è G√©n√©rer une description IA
      </button>
    </div>`}

    ${a.photo ? '<img src="'+a.photo+'" style="width:100%;height:160px;object-fit:cover;border-radius:10px;margin-top:1rem;border:1px solid var(--border);" alt="">' : ''}

    ${(a.status === 'online' && days >= 14 && a.sellPrice > 0) ? `
    <div style="margin-top:1rem;background:var(--yellow-d);border:1px solid var(--yellow);border-radius:12px;padding:0.9rem;">
      <div style="font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--yellow);margin-bottom:0.6rem;">‚è± En ligne depuis ${days} jours</div>
      <div style="font-size:0.78rem;color:var(--muted2);margin-bottom:0.7rem;">Baisser le prix pour relancer ?</div>
      <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
        <button onclick="applyDiscount('${id}',10)" style="flex:1;padding:0.5rem;background:var(--s2);border:1px solid var(--yellow);border-radius:8px;color:var(--yellow);font-family:'Bricolage Grotesque',sans-serif;font-size:0.75rem;font-weight:800;cursor:pointer;">
          -10%<br><span style="font-size:0.95rem;color:var(--text);">${(a.sellPrice*0.9).toFixed(2)}‚Ç¨</span>
        </button>
        <button onclick="applyDiscount('${id}',15)" style="flex:1;padding:0.5rem;background:var(--s2);border:1px solid var(--yellow);border-radius:8px;color:var(--yellow);font-family:'Bricolage Grotesque',sans-serif;font-size:0.75rem;font-weight:800;cursor:pointer;">
          -15%<br><span style="font-size:0.95rem;color:var(--text);">${(a.sellPrice*0.85).toFixed(2)}‚Ç¨</span>
        </button>
        <button onclick="applyDiscount('${id}',20)" style="flex:1;padding:0.5rem;background:var(--s2);border:1px solid var(--yellow);border-radius:8px;color:var(--yellow);font-family:'Bricolage Grotesque',sans-serif;font-size:0.75rem;font-weight:800;cursor:pointer;">
          -20%<br><span style="font-size:0.95rem;color:var(--text);">${(a.sellPrice*0.8).toFixed(2)}‚Ç¨</span>
        </button>
      </div>
      ${a.priceHistory && a.priceHistory.length > 0 ? '<div style="font-size:0.68rem;color:var(--muted);margin-top:0.6rem;">'+a.priceHistory.length+' relance(s) effectu√©e(s) ¬∑ Prix initial : '+a.priceHistory[0].from.toFixed(2)+'‚Ç¨</div>' : ''}
    </div>` : ''}

    <div class="detail-actions" style="margin-top:0.9rem;">
      <button class="btn btn-ghost" onclick="editArticle('${id}')">‚úèÔ∏è Modifier</button>
      <button class="btn btn-ghost" onclick="duplicateArticle('${id}')">üìã Dupliquer</button>
    </div>
    <button class="btn btn-danger" style="margin-top:0.5rem;" onclick="deleteArticle('${id}')">üóëÔ∏è Supprimer</button>
    ${a.status === 'sold' ? '<button class="btn btn-ghost" style="margin-top:0.5rem;width:100%;" onclick="closeModal(\'modal-detail\');openInvoice(\''+id+'\')">üßæ G√©n√©rer la facture</button>' : ''}
  `;

  openModal('modal-detail');
}

function changeStatus(id, status) {
  const a = articles.find(x => x.id === id);
  if (!a) return;
  a.status = status;
  if (status === 'sold') a.soldAt = new Date().toISOString();
  a.updatedAt = new Date().toISOString();
  save();
  openDetail(id);
  renderArticles();
  renderDashboard();
  showToast('Statut mis √† jour');
}

function editArticle(id) {
  const a = articles.find(x => x.id === id);
  if (!a) return;
  editingId = id;
  closeModal('modal-detail');
  document.getElementById('aName').value = a.name;
  document.getElementById('aBrand').value = a.brand || '';
  document.getElementById('aSize').value = a.size || '';
  document.getElementById('aBuyPrice').value = a.buyPrice || '';
  document.getElementById('aSellPrice').value = a.sellPrice || '';
  document.getElementById('aCondition').value = a.condition;
  document.getElementById('aNotes').value = a.notes || '';
  document.getElementById('aPrivateNote').value = a.privateNote || '';
  document.getElementById('aStatus').value = a.status;
  document.querySelector('.modal-title').childNodes[0].textContent = 'Modifier ';
  openModal('modal-add');
}

function deleteArticle(id) {
  if (!confirm('Supprimer cet article ?')) return;
  articles = articles.filter(a => a.id !== id);
  save();
  closeModal('modal-detail');
  renderArticles();
  renderDashboard();
  showToast('Article supprim√©');
}

function copyText(id) {
  const a = articles.find(x => x.id === id);
  if (!a?.description) return;
  navigator.clipboard.writeText(a.description).then(() => showToast('‚úì Copi√© !'));
}

function prefillGenerate(id) {
  const a = articles.find(x => x.id === id);
  if (!a) return;
  document.getElementById('freeInput').value = [a.name, a.brand, a.size, a.condition, a.notes].filter(Boolean).join(', ');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ARTICLES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setFilter(el, f) {
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  currentFilter = f;
  renderArticles();
}

function renderArticles() {
  const searchQ = (document.getElementById('searchInput')?.value || '').toLowerCase().trim();
  let filtered = currentFilter === 'all' ? articles : articles.filter(a => a.status === currentFilter);
  if (searchQ) {
    filtered = filtered.filter(a =>
      a.name.toLowerCase().includes(searchQ) ||
      (a.brand||'').toLowerCase().includes(searchQ) ||
      (a.size||'').toLowerCase().includes(searchQ) ||
      (a.notes||'').toLowerCase().includes(searchQ)
    );
  }
  filtered = applySortAndFilter(filtered);
  document.getElementById('articleCount').textContent = filtered.length;
  const list = document.getElementById('articlesList');

  if (filtered.length === 0) {
    list.innerHTML = `<div class="empty"><div class="ei">üëï</div><p>${currentFilter === 'all' ? 'Aucun article pour l\'instant.<br>Clique sur + Ajouter !' : 'Aucun article dans cette cat√©gorie.'}</p></div>`;
    return;
  }

  list.innerHTML = filtered.map(a => {
    const urssaf = a.sellPrice * 0.123;
    const profit = a.sellPrice - urssaf - a.buyPrice;
    const days = Math.floor((Date.now() - new Date(a.createdAt)) / 86400000);
    return `
    <div class="article-card" onclick="openDetail('${a.id}')">
      <div style="display:flex;gap:0.8rem;align-items:flex-start;">
        ${a.photo ? '<img src="'+a.photo+'" style="width:64px;height:64px;object-fit:cover;border-radius:8px;border:1px solid var(--border);flex-shrink:0;" alt="">' : ''}
        <div style="flex:1;min-width:0;">
          <div class="article-header" style="margin-bottom:0.3rem;">
            <div>
              <div class="article-name">${escHtml(a.name)}</div>
              ${a.brand || a.size ? '<div class="article-brand">'+[a.brand, a.size].filter(Boolean).join(' ¬∑ ')+'</div>' : ''}
            </div>
            <span class="status-badge ${STATUS_CLASS[a.status]}">${STATUS_LABELS[a.status]}${(a.status==='online' && Math.floor((Date.now()-new Date(a.createdAt))/86400000)>14) ? '<span class="alert-dot"></span>' : ''}</span>
          </div>
        </div>
      </div>
      <div class="article-footer">
        <div>
          <div class="article-price">${a.sellPrice > 0 ? a.sellPrice.toFixed(2) + ' ‚Ç¨' : '‚Äî'}</div>
          ${a.sellPrice > 0 ? `<div class="article-profit ${profit >= 0 ? 'pos' : 'neg'}">${profit >= 0 ? '+' : ''}${profit.toFixed(2)} ‚Ç¨ net</div>` : ''}
        </div>
        <div class="article-days">${days === 0 ? 'Aujourd\'hui' : 'Il y a ' + days + 'j'}</div>
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard() {
  const now = new Date();
  const sold = articles.filter(a => a.status === 'sold');
  const online = articles.filter(a => a.status === 'online');

  let totalRevenu = 0, totalUrssaf = 0;
  sold.forEach(a => {
    const u = a.sellPrice * 0.123;
    totalUrssaf += u;
    totalRevenu += a.sellPrice - u - a.buyPrice;
  });

  // This month URSSAF only
  const thisMonthSold = sold.filter(a => {
    const d = new Date(a.soldAt || a.updatedAt);
    return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
  });
  const thisMonthUrssaf = thisMonthSold.reduce((s,a) => s + a.sellPrice*0.123, 0);

  document.getElementById('statRevenu').textContent = totalRevenu.toFixed(0) + '‚Ç¨';
  document.getElementById('statVendus').textContent = sold.length;
  document.getElementById('statEnLigne').textContent = online.length;
  document.getElementById('statUrssaf').textContent = thisMonthUrssaf.toFixed(0) + '‚Ç¨';
  renderGoalWidget();

  // Mini chart ‚Äî derniers 6 mois
  const months = [];
  for (let i = 5; i >= 0; i--) {
    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
    const key = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0');
    const label = d.toLocaleDateString('fr-FR', { month: 'short' });
    const monthSold = sold.filter(a => {
      const sd = new Date(a.soldAt || a.updatedAt);
      return sd.getFullYear() + '-' + String(sd.getMonth() + 1).padStart(2, '0') === key;
    });
    const profit = monthSold.reduce((sum, a) => sum + (a.sellPrice - a.sellPrice * 0.123 - a.buyPrice), 0);
    months.push({ label, profit });
  }
  const maxP = Math.max(...months.map(m => m.profit), 1);
  document.getElementById('miniChart').innerHTML = months.map(m => {
    const h = Math.max(4, Math.round((m.profit / maxP) * 50));
    return `<div class="bar-col" style="height:${h}px;" title="${m.profit.toFixed(2)}‚Ç¨"></div>`;
  }).join('');
  document.getElementById('chartLabels').innerHTML = months.map(m =>
    `<div class="chart-label">${m.label}</div>`
  ).join('');

  // Activity feed
  const recent = [...articles].sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)).slice(0, 6);
  if (recent.length === 0) {
    document.getElementById('activityFeed').innerHTML = `<div class="empty"><div class="ei">üì≠</div><p>Aucune activit√©.<br>Ajoute ton premier article !</p></div>`;
    return;
  }
  document.getElementById('activityFeed').innerHTML = recent.map(a => `
    <div class="activity-item" onclick="openDetail('${a.id}');showTab('articles',1);" style="cursor:pointer;">
      <div class="act-dot" style="background:${STATUS_DOT[a.status]};"></div>
      <div class="act-info">
        <div class="act-name">${escHtml(a.name)}</div>
        <div class="act-sub">${fmtDate(a.updatedAt)}</div>
      </div>
      ${a.sellPrice > 0 ? `<span class="act-badge" style="background:var(--s2);color:var(--muted2);">${a.sellPrice.toFixed(0)}‚Ç¨</span>` : ''}
    </div>
  `).join('');

  renderWeeklyRecap();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GENERATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll('.pill').forEach(p => {
  p.addEventListener('click', () => {
    document.querySelectorAll('.pill').forEach(x => x.classList.remove('active'));
    p.classList.add('active');
  });
});

const apiKeyEl = document.getElementById('apiKeyInput');
const keyPill = document.getElementById('keyPill');
const apiDot = document.getElementById('apiDot');

function updateKeyStatus(val) {
  const ok = val && val.startsWith('sk-ant-');
  keyPill.textContent = ok ? 'ON' : 'OFF';
  keyPill.className = 'key-pill' + (ok ? ' ok' : '');
  apiDot.className = 'api-dot' + (ok ? ' ok' : '');
}

const savedKey = getKey();
if (savedKey) { apiKeyEl.value = savedKey; updateKeyStatus(savedKey); }

apiKeyEl.addEventListener('input', () => {
  const v = apiKeyEl.value.trim();
  if (v.startsWith('sk-ant-')) localStorage.setItem('vcrm_apikey', v);
  updateKeyStatus(v);
});

async function generateDesc() {
  const text = document.getElementById('freeInput').value.trim();
  if (!text) { showToast('D√©cris ton article !'); return; }
  const key = apiKeyEl.value.trim() || getKey();
  if (!key.startsWith('sk-ant-')) { showToast('üîë Configure ta cl√© API'); return; }

  const tone = document.querySelector('.pill.active').dataset.tone;
  const toneMap = {
    casual: 'Ton d√©contract√© et sympa avec quelques emojis bien plac√©s. Accrocheur et humain.',
    chic: 'Ton √©l√©gant et soign√©, sans emojis. Langage raffin√©.',
    punchy: 'Tr√®s court et percutant. Maximum 5-6 lignes. Va droit au but.',
    detailed: 'Description compl√®te et structur√©e avec sections claires.'
  };

  const prompt = 'Tu es expert en vente sur Vinted. G√©n√®re une description d\'annonce optimis√©e.\n\nArticle : "' + text + '"\n\nStyle : ' + toneMap[tone] + '\n\nNote : frais de port √† la charge de l\'acheteur sur Vinted.\nR√©ponds UNIQUEMENT avec le texte de l\'annonce, pr√™t √† copier-coller. Sans introduction ni commentaire.';

  const btn = document.getElementById('genBtn');
  btn.disabled = true; btn.textContent = 'G√©n√©ration‚Ä¶';
  document.getElementById('genResult').innerHTML = '<div class="loading"><div class="spinner"></div>R√©daction en cours‚Ä¶</div>';

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': key,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({ model: 'claude-sonnet-4-20250514', max_tokens: 600, messages: [{ role: 'user', content: prompt }] })
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error.message);
    const desc = data.content[0].text;
    lastGeneratedDesc = desc;

    document.getElementById('genResult').innerHTML = `
      <div class="result-card">
        <div class="result-head">
          <span>Description g√©n√©r√©e</span>
          <button class="copy-btn" onclick="navigator.clipboard.writeText(lastGeneratedDesc).then(()=>showToast('‚úì Copi√© !'))">Copier</button>
        </div>
        <div class="result-body">${escHtml(desc)}</div>
        <div style="display:flex;gap:0;border-top:1px solid var(--border);">
          <button class="save-to-article-btn" style="flex:1;border-right:1px solid var(--border);" onclick="openSaveDescModal()">üìå Attacher</button>
          <button class="save-to-article-btn" style="flex:1;" onclick="shareDescription(lastGeneratedDesc)">üì§ Partager</button>
        </div>
      </div>`;
    showToast('Description g√©n√©r√©e !');
  } catch(e) {
    document.getElementById('genResult').innerHTML = `<div style="color:var(--red);font-size:0.85rem;padding:1rem;text-align:center;">Erreur : ${e.message}</div>`;
  } finally {
    btn.disabled = false; btn.textContent = '‚ú¶ G√©n√©rer la description';
  }
}

let lastGeneratedDesc = '';

function openSaveDescModal() {
  if (!articles.length) { showToast('Aucun article ‚Äî ajoutes-en un d\'abord'); return; }
  const choice = prompt('Num√©ro de l\'article (ou tape son nom) :\n' + articles.map((a, i) => `${i + 1}. ${a.name}`).join('\n'));
  if (!choice) return;
  const idx = parseInt(choice) - 1;
  const article = isNaN(idx) ? articles.find(a => a.name.toLowerCase().includes(choice.toLowerCase())) : articles[idx];
  if (!article) { showToast('Article introuvable'); return; }
  article.description = lastGeneratedDesc;
  article.updatedAt = new Date().toISOString();
  save();
  showToast('Description attach√©e √† ' + article.name);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRICE CALC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcPrice() {
  const buy = parseFloat(document.getElementById('pBuy').value) || 0;
  const sell = parseFloat(document.getElementById('pSell').value) || 0;
  if (!sell) { document.getElementById('priceGrid').style.display = 'none'; document.getElementById('progBar').style.display = 'none'; return; }
  const urssaf = sell * 0.123;
  const profit = sell - urssaf - buy;
  const margin = buy > 0 ? (profit / buy * 100) : null;

  document.getElementById('priceGrid').style.display = 'grid';
  document.getElementById('progBar').style.display = 'block';
  document.getElementById('pvRevenu').textContent = (sell - urssaf).toFixed(2) + '‚Ç¨';
  document.getElementById('pvUrssaf').textContent = '-' + urssaf.toFixed(2) + '‚Ç¨';
  document.getElementById('pvProfit').textContent = (profit >= 0 ? '+' : '') + profit.toFixed(2) + '‚Ç¨';
  document.getElementById('pvMargin').textContent = margin !== null ? (profit >= 0 ? '+' : '') + margin.toFixed(1) + '%' : '‚Äî';
  const pb = document.getElementById('pProfitBox');
  pb.className = 'p-box ' + (profit >= 0 ? 'g' : 'r');
  const pct = Math.min(100, Math.max(0, margin !== null ? Math.abs(margin) : 50));
  document.getElementById('progFill').style.width = pct + '%';
  document.getElementById('progFill').className = 'prog-fill' + (profit < 0 ? ' neg' : '');
}

function calcSuggest() {
  const buy = parseFloat(document.getElementById('sBuy').value) || 0;
  const wantedProfit = parseFloat(document.getElementById('sProfit').value) || 0;
  if (!buy && !wantedProfit) { document.getElementById('suggestOut').style.display = 'none'; return; }
  const suggested = (buy + wantedProfit) / 0.877;
  const urssaf = suggested * 0.123;
  document.getElementById('suggestOut').style.display = 'block';
  document.getElementById('suggestVal').textContent = suggested.toFixed(2) + ' ‚Ç¨';
  document.getElementById('suggestDetail').textContent = 'dont ' + urssaf.toFixed(2) + '‚Ç¨ URSSAF ¬∑ b√©n√©fice net : ' + wantedProfit.toFixed(2) + '‚Ç¨';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveSettings() {
  const k = document.getElementById('settingsKey').value.trim();
  const company = document.getElementById('settingsCompany').value.trim();
  if (company) localStorage.setItem('vcrm_company', company);
  if (k.startsWith('sk-ant-')) {
    localStorage.setItem('vcrm_apikey', k);
    apiKeyEl.value = k;
    updateKeyStatus(k);
    showToast('‚úì Sauvegard√©');
  } else if (company) {
    showToast('‚úì Entreprise sauvegard√©e');
  } else {
    showToast('Cl√© invalide');
  }
  closeModal('modal-settings');
}

function openExportModal() {
  // Populate year selector
  const yearSel = document.getElementById('exportYear');
  yearSel.innerHTML = '';
  const now = new Date();
  for (let y = now.getFullYear(); y >= now.getFullYear() - 3; y--) {
    const o = document.createElement('option');
    o.value = y; o.textContent = y;
    yearSel.appendChild(o);
  }
  // Set current month
  document.getElementById('exportMonth').value = now.getMonth();
  updateExportPreview();
  ['exportMonth','exportYear'].forEach(id => document.getElementById(id).addEventListener('change', updateExportPreview));
  openModal('modal-export');
}

function updateExportPreview() {
  const m = parseInt(document.getElementById('exportMonth').value);
  const y = parseInt(document.getElementById('exportYear').value);
  const filtered = getSoldInMonth(m, y);
  const totalSell = filtered.reduce((s, a) => s + a.sellPrice, 0);
  const totalUrssaf = filtered.reduce((s, a) => s + a.sellPrice * 0.123, 0);
  const totalProfit = filtered.reduce((s, a) => s + (a.sellPrice - a.sellPrice * 0.123 - a.buyPrice), 0);
  const prev = document.getElementById('exportPreview');
  if (filtered.length === 0) {
    prev.style.display = 'block';
    prev.textContent = 'Aucun article vendu ce mois-ci.';
    return;
  }
  prev.style.display = 'block';
  prev.innerHTML = filtered.length + ' article(s) vendu(s) ¬∑ CA : ' + totalSell.toFixed(2) + '‚Ç¨ ¬∑ URSSAF : ' + totalUrssaf.toFixed(2) + '‚Ç¨ ¬∑ B√©n√©fice net : <strong style="color:var(--green)">' + totalProfit.toFixed(2) + '‚Ç¨</strong>';
}

function getSoldInMonth(month, year) {
  return articles
    .filter(a => {
      if (a.status !== 'sold') return false;
      const d = new Date(a.soldAt || a.updatedAt);
      return d.getMonth() === month && d.getFullYear() === year;
    })
    .sort((a, b) => new Date(a.soldAt || a.updatedAt) - new Date(b.soldAt || b.updatedAt));
}

function doExportCSV() {
  const m = parseInt(document.getElementById('exportMonth').value);
  const y = parseInt(document.getElementById('exportYear').value);
  const filtered = getSoldInMonth(m, y);
  if (filtered.length === 0) { showToast('Aucun article vendu ce mois'); return; }

  const monthName = ['Janvier','F√©vrier','Mars','Avril','Mai','Juin','Juillet','Ao√ªt','Septembre','Octobre','Novembre','D√©cembre'][m];
  const rows = ['Date de vente,Nom article,Marque,Taille,√âtat,Prix achat (‚Ç¨),Prix vente (‚Ç¨),URSSAF 12.3% (‚Ç¨),B√©n√©fice net (‚Ç¨)'];
  filtered.forEach(a => {
    const date = new Date(a.soldAt || a.updatedAt).toLocaleDateString('fr-FR');
    const u = (a.sellPrice * 0.123).toFixed(2);
    const p = (a.sellPrice - a.sellPrice * 0.123 - a.buyPrice).toFixed(2);
    rows.push([date, '"'+a.name+'"', a.brand||'', a.size||'', a.condition, a.buyPrice.toFixed(2), a.sellPrice.toFixed(2), u, p].join(','));
  });

  // Totals row
  const totSell = filtered.reduce((s,a) => s+a.sellPrice, 0);
  const totUrssaf = filtered.reduce((s,a) => s+a.sellPrice*0.123, 0);
  const totProfit = filtered.reduce((s,a) => s+(a.sellPrice-a.sellPrice*0.123-a.buyPrice), 0);
  rows.push(['TOTAL','','','','','', totSell.toFixed(2), totUrssaf.toFixed(2), totProfit.toFixed(2)].join(','));

  const blob = new Blob([rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'vinted-' + monthName + '-' + y + '.csv';
  link.click();
  closeModal('modal-export');
  showToast('Export ' + monthName + ' ' + y + ' t√©l√©charg√©');
}

// ‚îÄ‚îÄ‚îÄ INVOICE ‚îÄ‚îÄ‚îÄ
let currentInvoiceArticle = null;

function openInvoice(articleId) {
  const a = articles.find(x => x.id === articleId);
  if (!a) return;
  currentInvoiceArticle = a;

  // Pre-fill seller from saved company
  const company = localStorage.getItem('vcrm_company') || '';
  document.getElementById('invSeller').value = company;
  document.getElementById('invBuyer').value = '';

  renderInvoicePreview(a);
  openModal('modal-invoice');

  document.getElementById('invSeller').addEventListener('input', () => renderInvoicePreview(a));
  document.getElementById('invBuyer').addEventListener('input', () => renderInvoicePreview(a));
}

function renderInvoicePreview(a) {
  const seller = document.getElementById('invSeller').value || '________________';
  const buyer = document.getElementById('invBuyer').value || '________________';
  const date = new Date(a.soldAt || a.updatedAt).toLocaleDateString('fr-FR');
  const invoiceNum = 'FAC-' + new Date(a.soldAt || a.updatedAt).getFullYear() + '-' + a.id.slice(-4).toUpperCase();
  document.getElementById('invPreview').innerHTML = [
    '<strong>N¬∞ Facture :</strong> ' + invoiceNum,
    '<strong>Date :</strong> ' + date,
    '',
    '<strong>Vendeur :</strong> ' + seller,
    '<strong>Acheteur :</strong> ' + buyer,
    '',
    '<strong>Article :</strong> ' + a.name + (a.brand ? ' ‚Äî ' + a.brand : '') + (a.size ? ' ‚Äî Taille ' + a.size : ''),
    '<strong>√âtat :</strong> ' + a.condition,
    '',
    '<strong>Prix de vente :</strong> ' + a.sellPrice.toFixed(2) + ' ‚Ç¨',
    '<strong>TVA :</strong> Non applicable (micro-entrepreneur)',
    '',
    '<em style="color:var(--muted2);font-size:0.75rem;">Vente r√©alis√©e via Vinted. Frais de port √† la charge de l\'acheteur.</em>'
  ].join('<br>');
}

function printInvoice() {
  const a = currentInvoiceArticle;
  if (!a) return;
  const seller = document.getElementById('invSeller').value || '________________';
  const buyer = document.getElementById('invBuyer').value || '________________';
  const date = new Date(a.soldAt || a.updatedAt).toLocaleDateString('fr-FR');
  const invoiceNum = 'FAC-' + new Date(a.soldAt || a.updatedAt).getFullYear() + '-' + a.id.slice(-4).toUpperCase();

  const html = `<!DOCTYPE html>
<html lang="fr"><head><meta charset="UTF-8">
<title>Facture ${invoiceNum}</title>
<style>
  body { font-family: Georgia, serif; max-width: 680px; margin: 40px auto; padding: 0 2rem; color: #111; }
  h1 { font-size: 2rem; font-weight: 400; border-bottom: 2px solid #111; padding-bottom: 0.5rem; margin-bottom: 2rem; }
  .meta { display: flex; justify-content: space-between; margin-bottom: 2rem; }
  .bloc { margin-bottom: 1.5rem; }
  .bloc h3 { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: #666; margin-bottom: 0.3rem; }
  .bloc p { font-size: 1rem; }
  table { width: 100%; border-collapse: collapse; margin: 2rem 0; }
  th { text-align: left; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; color: #666; padding: 0.5rem 0; border-bottom: 1px solid #ddd; }
  td { padding: 0.7rem 0; border-bottom: 1px solid #eee; font-size: 0.95rem; }
  td:last-child, th:last-child { text-align: right; }
  .total { font-size: 1.1rem; font-weight: bold; }
  .footer { margin-top: 3rem; font-size: 0.75rem; color: #888; border-top: 1px solid #ddd; padding-top: 1rem; }
  @media print { body { margin: 20px; } }
</style></head><body>
<h1>Facture</h1>
<div class="meta">
  <div><strong style="font-size:0.72rem;text-transform:uppercase;letter-spacing:0.08em;color:#666;">N¬∞ Facture</strong><br>${invoiceNum}</div>
  <div style="text-align:right;"><strong style="font-size:0.72rem;text-transform:uppercase;letter-spacing:0.08em;color:#666;">Date</strong><br>${date}</div>
</div>
<div style="display:flex;gap:3rem;margin-bottom:2rem;">
  <div class="bloc" style="flex:1"><h3>Vendeur</h3><p>${seller}</p></div>
  <div class="bloc" style="flex:1"><h3>Acheteur</h3><p>${buyer}</p></div>
</div>
<table>
  <tr><th>Article</th><th>√âtat</th><th>Montant</th></tr>
  <tr>
    <td>${a.name}${a.brand ? ' ‚Äî ' + a.brand : ''}${a.size ? '<br><small style="color:#888">Taille ' + a.size + '</small>' : ''}</td>
    <td>${a.condition}</td>
    <td>${a.sellPrice.toFixed(2)} ‚Ç¨</td>
  </tr>
  <tr><td colspan="2" class="total">Total factur√©</td><td class="total">${a.sellPrice.toFixed(2)} ‚Ç¨</td></tr>
</table>
<p style="font-size:0.82rem;color:#666;">TVA non applicable ‚Äî article 293B du CGI (micro-entrepreneur)</p>
<p style="font-size:0.82rem;color:#666;">Frais de port √† la charge de l'acheteur via la plateforme Vinted.</p>
<div class="footer">Facture g√©n√©r√©e le ${new Date().toLocaleDateString('fr-FR')} ¬∑ Vinted CRM</div>
</body></html>`;

  const w = window.open('', '_blank');
  w.document.write(html);
  w.document.close();
  w.print();
}

function clearAllData() {
  if (!confirm('‚ö†Ô∏è Supprimer TOUS les articles ? Cette action est irr√©versible.')) return;
  articles = [];
  localStorage.removeItem('vcrm_articles');
  renderDashboard(); renderArticles();
  closeModal('modal-settings');
  showToast('Donn√©es supprim√©es');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function fmtDate(iso) {
  const d = new Date(iso);
  return d.toLocaleDateString('fr-FR', { day:'2-digit', month:'2-digit', year:'2-digit' }) + ' ' +
    d.toLocaleTimeString('fr-FR', { hour:'2-digit', minute:'2-digit' });
}
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PHOTO HANDLING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentPhotoData = null;

function handlePhoto(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const img = new Image();
    img.onload = () => {
      // Toujours compresser pour √©conomiser l'espace localStorage
      const MAX = 600;
      const ratio = Math.min(1, MAX / Math.max(img.width, img.height));
      const canvas = document.createElement('canvas');
      canvas.width = Math.round(img.width * ratio);
      canvas.height = Math.round(img.height * ratio);
      canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
      currentPhotoData = canvas.toDataURL('image/jpeg', 0.7);
      const preview = document.getElementById('aPhotoPreview');
      preview.src = currentPhotoData;
      preview.style.display = 'block';
      document.querySelector('.photo-placeholder').style.display = 'none';
      const kb = Math.round(currentPhotoData.length * 0.75 / 1024);
      showToast('Photo optimisee (' + kb + ' Ko)');
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GOAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveGoal() {
  const g = parseFloat(document.getElementById('goalAmount').value) || 0;
  localStorage.setItem('vcrm_goal', g);
  closeModal('modal-goal');
  renderGoalWidget();
  showToast('Objectif enregistr√©');
}

function renderGoalWidget() {
  const goal = parseFloat(localStorage.getItem('vcrm_goal')) || 0;
  const now = new Date();
  const thisMonth = articles.filter(a => {
    if (a.status !== 'sold') return false;
    const d = new Date(a.soldAt || a.updatedAt);
    return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
  });
  const profit = thisMonth.reduce((s,a) => s + (a.sellPrice - a.sellPrice*0.123 - a.buyPrice), 0);
  const widget = document.getElementById('goalWidget');

  if (!goal) {
    widget.innerHTML = '<div style="font-size:0.82rem;color:var(--muted);text-align:center;padding:0.5rem;">Aucun objectif d√©fini. Clique sur ‚úèÔ∏è Modifier.</div>';
    return;
  }

  const pct = Math.min(100, Math.round((profit / goal) * 100));
  const over = profit >= goal;
  widget.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:baseline;">
      <span style="font-family:'Instrument Serif',serif;font-size:1.6rem;color:${over ? 'var(--yellow)' : 'var(--green)'};">${profit.toFixed(0)}‚Ç¨</span>
      <span style="font-size:0.78rem;color:var(--muted2);">/ ${goal.toFixed(0)}‚Ç¨ vis√©s</span>
    </div>
    <div class="goal-bar-wrap">
      <div class="goal-bar"><div class="goal-bar-fill ${over ? 'over' : ''}" style="width:${pct}%;"></div></div>
      <div class="goal-labels"><span>${pct}% atteint</span><span>${over ? 'üéâ Objectif d√©pass√© !' : (goal - profit).toFixed(0) + '‚Ç¨ restants'}</span></div>
    </div>`;
  document.getElementById('goalAmount') && (document.getElementById('goalAmount').value = goal);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATS MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openStatsModal() {
  const now = new Date();
  const sold = articles.filter(a => a.status === 'sold');
  const online = articles.filter(a => a.status === 'online');

  // Best seller brand
  const brandCount = {};
  sold.forEach(a => { if (a.brand) brandCount[a.brand] = (brandCount[a.brand]||0) + 1; });
  const topBrand = Object.entries(brandCount).sort((a,b) => b[1]-a[1])[0];

  // Average sell price
  const avgSell = sold.length ? sold.reduce((s,a) => s+a.sellPrice, 0) / sold.length : 0;
  const avgProfit = sold.length ? sold.reduce((s,a) => s+(a.sellPrice-a.sellPrice*0.123-a.buyPrice), 0) / sold.length : 0;

  // Average days online before sale (approx)
  const avgDays = sold.length ? sold.reduce((s,a) => {
    const diff = (new Date(a.soldAt||a.updatedAt) - new Date(a.createdAt)) / 86400000;
    return s + diff;
  }, 0) / sold.length : 0;

  // This month URSSAF
  const thisMonth = sold.filter(a => {
    const d = new Date(a.soldAt||a.updatedAt);
    return d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear();
  });
  const monthUrssaf = thisMonth.reduce((s,a) => s+a.sellPrice*0.123, 0);
  const monthCA = thisMonth.reduce((s,a) => s+a.sellPrice, 0);

  // Alerts: articles online > 14 days
  const alerts = online.filter(a => {
    const days = (Date.now() - new Date(a.createdAt)) / 86400000;
    return days > 14;
  });

  document.getElementById('statsContent').innerHTML = `
    <div style="font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted2);margin-bottom:0.7rem;">Ce mois-ci</div>
    <div class="stat-row"><span class="stat-row-lbl">Chiffre d'affaires</span><span class="stat-row-val">${monthCA.toFixed(2)} ‚Ç¨</span></div>
    <div class="stat-row"><span class="stat-row-lbl">URSSAF √† d√©clarer</span><span class="stat-row-val" style="color:var(--red);">${monthUrssaf.toFixed(2)} ‚Ç¨</span></div>
    <div class="stat-row"><span class="stat-row-lbl">Articles vendus ce mois</span><span class="stat-row-val">${thisMonth.length}</span></div>

    <div style="font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted2);margin:1rem 0 0.7rem;">Tout temps</div>
    <div class="stat-row"><span class="stat-row-lbl">Total articles vendus</span><span class="stat-row-val">${sold.length}</span></div>
    <div class="stat-row"><span class="stat-row-lbl">Prix de vente moyen</span><span class="stat-row-val">${avgSell.toFixed(2)} ‚Ç¨</span></div>
    <div class="stat-row"><span class="stat-row-lbl">B√©n√©fice moyen / article</span><span class="stat-row-val" style="color:var(--green);">${avgProfit.toFixed(2)} ‚Ç¨</span></div>
    <div class="stat-row"><span class="stat-row-lbl">D√©lai moyen avant vente</span><span class="stat-row-val">${avgDays.toFixed(0)} jours</span></div>
    ${topBrand ? '<div class="stat-row"><span class="stat-row-lbl">Marque la plus vendue</span><span class="stat-row-val">'+topBrand[0]+' ('+topBrand[1]+'x)</span></div>' : ''}

    ${alerts.length > 0 ? `
    <div style="font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--yellow);margin:1rem 0 0.7rem;">‚ö†Ô∏è Alertes (${alerts.length})</div>
    ${alerts.map(a => {
      const days = Math.floor((Date.now()-new Date(a.createdAt))/86400000);
      return '<div class="stat-row"><span class="stat-row-lbl">'+escHtml(a.name)+'</span><span class="stat-row-val" style="color:var(--yellow);">'+days+'j en ligne</span></div>';
    }).join('')}` : ''}
  `;

  openModal('modal-stats');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DUPLICATE ARTICLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function duplicateArticle(id) {
  const a = articles.find(x => x.id === id);
  if (!a) return;
  const copy = { ...a, id: Date.now().toString(), name: a.name + ' (copie)', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), status: 'online', soldAt: null };
  articles.unshift(copy);
  save();
  renderArticles();
  renderDashboard();
  closeModal('modal-detail');
  showToast('Article dupliqu√©');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEB SHARE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function shareDescription(text) {
  if (navigator.share) {
    navigator.share({ text }).catch(() => {});
  } else {
    navigator.clipboard.writeText(text).then(() => showToast('‚úì Copi√© !'));
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BACKUP / RESTORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function backupData() {
  const backup = {
    version: 1,
    exportedAt: new Date().toISOString(),
    articles: articles,
    goal: localStorage.getItem('vcrm_goal'),
    company: localStorage.getItem('vcrm_company'),
    templates: getTemplates(),
  };
  const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  const date = new Date().toLocaleDateString('fr-FR').replace(/\//g, '-');
  link.href = url;
  link.download = 'vintedcrm-backup-' + date + '.json';
  link.click();
  showToast('üíæ Sauvegarde t√©l√©charg√©e !');
}

function restoreData(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const backup = JSON.parse(e.target.result);
      if (!backup.articles || !Array.isArray(backup.articles)) throw new Error('Fichier invalide');
      if (!confirm('Restaurer ' + backup.articles.length + ' article(s) depuis la sauvegarde du ' + new Date(backup.exportedAt).toLocaleDateString('fr-FR') + ' ?\n\nCela remplacera toutes tes donn√©es actuelles.')) return;
      articles = backup.articles;
      save();
      if (backup.goal) localStorage.setItem('vcrm_goal', backup.goal);
      if (backup.company) localStorage.setItem('vcrm_company', backup.company);
      if (backup.templates) saveTemplates(backup.templates);
      renderDashboard();
      renderArticles();
      closeModal('modal-settings');
      showToast('‚úì ' + articles.length + ' articles restaur√©s !');
    } catch(err) {
      showToast('‚ùå Fichier invalide');
    }
  };
  reader.readAsText(file);
  input.value = '';
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TEMPLATES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getTemplates() {
  try { return JSON.parse(localStorage.getItem('vcrm_templates') || '[]'); } catch { return []; }
}
function saveTemplates(tpls) {
  localStorage.setItem('vcrm_templates', JSON.stringify(tpls));
}

function saveAsTemplate() {
  const text = document.getElementById('freeInput').value.trim();
  if (!text) { showToast('Remplis le champ texte !'); return; }
  document.getElementById('templateName').value = '';
  document.getElementById('templateTextPreview').textContent = text.slice(0, 100) + (text.length > 100 ? '‚Ä¶' : '');
  openModal('modal-save-template');
}

function confirmSaveTemplate() {
  const name = document.getElementById('templateName').value.trim();
  const text = document.getElementById('freeInput').value.trim();
  if (!name) { showToast('Donne un nom au mod√®le !'); return; }
  const tpls = getTemplates();
  tpls.unshift({ id: Date.now().toString(), name, text, createdAt: new Date().toISOString() });
  saveTemplates(tpls);
  closeModal('modal-save-template');
  showToast('Mod√®le "' + name + '" sauvegard√© !');
}

function openTemplatesModal() {
  renderTemplates();
  openModal('modal-templates');
}

function renderTemplates() {
  const tpls = getTemplates();
  const list = document.getElementById('templatesList');
  const empty = document.getElementById('templatesEmpty');
  if (tpls.length === 0) {
    list.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';
  list.innerHTML = tpls.map((t, i) => `
    <div class="template-item">
      <div class="template-name">${escHtml(t.name)}</div>
      <div class="template-preview">${escHtml(t.text)}</div>
      <div class="template-actions">
        <button class="tpl-btn use" onclick="useTemplate(${i})">‚ú¶ Utiliser</button>
        <button class="tpl-btn del" onclick="deleteTemplate(${i})">Supprimer</button>
      </div>
    </div>
  `).join('');
}

function useTemplate(i) {
  const tpls = getTemplates();
  if (!tpls[i]) return;
  document.getElementById('freeInput').value = tpls[i].text;
  closeModal('modal-templates');
  showToast('Mod√®le "' + tpls[i].name + '" charg√© !');
}

function deleteTemplate(i) {
  const tpls = getTemplates();
  if (!confirm('Supprimer le mod√®le "' + tpls[i].name + '" ?')) return;
  tpls.splice(i, 1);
  saveTemplates(tpls);
  renderTemplates();
  showToast('Mod√®le supprim√©');
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentSort = 'date-desc';

function setSort(el, s) {
  document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  currentSort = s;
  renderArticles();
}

function applySortAndFilter(list) {
  switch(currentSort) {
    case 'date-asc':    return [...list].sort((a,b) => new Date(a.createdAt)-new Date(b.createdAt));
    case 'price-desc':  return [...list].sort((a,b) => b.sellPrice-a.sellPrice);
    case 'price-asc':   return [...list].sort((a,b) => a.sellPrice-b.sellPrice);
    case 'profit-desc': return [...list].sort((a,b) => (b.sellPrice-b.sellPrice*0.123-b.buyPrice)-(a.sellPrice-a.sellPrice*0.123-a.buyPrice));
    case 'days-desc':   return [...list].sort((a,b) => new Date(a.createdAt)-new Date(b.createdAt));
    default:            return [...list].sort((a,b) => new Date(b.createdAt)-new Date(a.createdAt));
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// QUICK ADD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveQuickArticle() {
  const name = document.getElementById('qName').value.trim();
  if (!name) { showToast('Renseigne le nom !'); return; }
  const article = {
    id: Date.now().toString(),
    name,
    brand: '', size: '', condition: '', notes: '', privateNote: '', description: '', photo: null,
    buyPrice: parseFloat(document.getElementById('qBuyPrice').value) || 0,
    sellPrice: parseFloat(document.getElementById('qSellPrice').value) || 0,
    status: document.getElementById('qStatus').value,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
    soldAt: document.getElementById('qStatus').value === 'sold' ? new Date().toISOString() : null,
  };
  articles.unshift(article);
  save();
  document.getElementById('qName').value = '';
  document.getElementById('qSellPrice').value = '';
  document.getElementById('qBuyPrice').value = '';
  document.getElementById('qStatus').value = 'online';
  closeModal('modal-quick-add');
  renderArticles();
  renderDashboard();
  showToast('‚ö° ' + name + ' ajout√© !');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRICE SUGGESTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function applyDiscount(id, pct) {
  const a = articles.find(x => x.id === id);
  if (!a) return;
  const oldPrice = a.sellPrice;
  const newPrice = parseFloat((oldPrice * (1 - pct/100)).toFixed(2));
  if (!a.priceHistory) a.priceHistory = [];
  a.priceHistory.push({ from: oldPrice, to: newPrice, pct, date: new Date().toISOString() });
  a.sellPrice = newPrice;
  a.updatedAt = new Date().toISOString();
  save();
  openDetail(id);
  renderArticles();
  renderDashboard();
  showToast('-' + pct + '% appliqu√© ‚Üí ' + newPrice.toFixed(2) + '‚Ç¨');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEEKLY RECAP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderWeeklyRecap() {
  const card = document.getElementById('weeklyRecapCard');
  const contentEl = document.getElementById('weeklyRecapContent');
  if (!card || !contentEl) return;

  // Only show on Monday or if not dismissed today
  const now = new Date();
  const lastSeen = localStorage.getItem('vcrm_recap_seen');
  const todayKey = now.toISOString().slice(0, 10);
  const isMonday = now.getDay() === 1;

  // Show if Monday and not already dismissed today
  if (!isMonday && lastSeen === todayKey) { card.style.display = 'none'; return; }
  if (!isMonday) { card.style.display = 'none'; return; }
  localStorage.setItem('vcrm_recap_seen', todayKey);

  // This week stats (last 7 days)
  const weekAgo = new Date(now - 7 * 86400000);
  const soldThisWeek = articles.filter(a => {
    if (a.status !== 'sold') return false;
    return new Date(a.soldAt || a.updatedAt) >= weekAgo;
  });
  const weekRevenu = soldThisWeek.reduce((s,a) => s + (a.sellPrice - a.sellPrice*0.123 - a.buyPrice), 0);
  const weekCA = soldThisWeek.reduce((s,a) => s + a.sellPrice, 0);

  // Articles approaching 14 days
  const approaching = articles.filter(a => {
    if (a.status !== 'online') return false;
    const days = Math.floor((Date.now() - new Date(a.createdAt)) / 86400000);
    return days >= 10 && days < 14;
  });

  // Articles already past 14 days
  const overdue = articles.filter(a => {
    if (a.status !== 'online') return false;
    return Math.floor((Date.now() - new Date(a.createdAt)) / 86400000) >= 14;
  });

  // This month URSSAF
  const thisMonth = articles.filter(a => {
    if (a.status !== 'sold') return false;
    const d = new Date(a.soldAt || a.updatedAt);
    return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
  });
  const monthUrssaf = thisMonth.reduce((s,a) => s + a.sellPrice*0.123, 0);

  card.style.display = 'block';

  contentEl.innerHTML = [
    soldThisWeek.length > 0
      ? '<div class="stat-row"><span class="stat-row-lbl">üéâ Vendus cette semaine</span><span class="stat-row-val" style="color:var(--green);">'+soldThisWeek.length+' article(s) ¬∑ +'+weekRevenu.toFixed(2)+'‚Ç¨</span></div>'
      : '<div class="stat-row"><span class="stat-row-lbl">Ventes cette semaine</span><span class="stat-row-val" style="color:var(--muted2);">Aucune vente</span></div>',

    monthUrssaf > 0
      ? '<div class="stat-row"><span class="stat-row-lbl">üí∂ URSSAF √† d√©clarer ce mois</span><span class="stat-row-val" style="color:var(--red);">'+monthUrssaf.toFixed(2)+'‚Ç¨</span></div>'
      : '',

    overdue.length > 0
      ? '<div class="stat-row"><span class="stat-row-lbl">‚ö†Ô∏è Articles +14j sans vente</span><span class="stat-row-val" style="color:var(--yellow);">'+overdue.length+' article(s)</span></div>'
      : '',

    approaching.length > 0
      ? '<div class="stat-row"><span class="stat-row-lbl">‚è± Bient√¥t 14 jours</span><span class="stat-row-val" style="color:var(--muted2);">'+approaching.map(a=>a.name).join(', ')+'</span></div>'
      : '',
  ].filter(Boolean).join('') || '<div style="font-size:0.82rem;color:var(--muted2);text-align:center;padding:0.5rem;">Tout roule, rien de particulier cette semaine üëå</div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
load();
renderDashboard();
renderArticles();
// Pre-fill goal input if set
const savedGoal = localStorage.getItem('vcrm_goal');
if (savedGoal && document.getElementById('goalAmount')) {
  document.getElementById('goalAmount').value = savedGoal;
}
</script>
</body>
</html>
